-- Salt v8 (Fixed Particles + GUI + Auto Aimbot Stable)
-- Только для себя, личное использование

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

local Settings = {
    Fly = false, FlySpeed = 50,
    Noclip = false,
    Speed = 16,
    InfiniteJump = false,
    ESP = false,
    Aimbot = false,
    AimbotFOV = 120,
    AimbotSmooth = 0.2,
    TeamCheck = true
}

local flyBody = nil
local noclipConn = nil
local drawings = {boxes = {}, names = {}, fov = nil}
local gui = nil

-- Создаём GUI один раз
local function createGUI()
    if gui then gui:Destroy() end
    
    gui = Instance.new("ScreenGui")
    gui.Name = "SaltV8"
    gui.ResetOnSpawn = false
    gui.ZIndexBehavior = Enum.ZIndexBehavior.Global
    gui.DisplayOrder = 10
    gui.Parent = game:GetService("CoreGui")
    
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0, 260, 0, 420)
    frame.Position = UDim2.new(0, 20, 0, 20)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    frame.BorderSizePixel = 0
    frame.ZIndex = 10
    frame.Parent = gui
    Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)
    
    -- Title + Drag
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1,0,0,40)
    title.BackgroundTransparency = 1
    title.Text = "Salt v8"
    title.TextColor3 = Color3.fromRGB(255,255,255)
    title.TextSize = 24
    title.Font = Enum.Font.GothamBold
    title.ZIndex = 11
    title.Parent = frame
    
    local dragging = false
    local dragStart, startPos
    title.InputBegan:Connect(function(inp)
        if inp.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = inp.Position
            startPos = frame.Position
        end
    end)
    title.InputChanged:Connect(function(inp)
        if dragging and inp.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = inp.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(inp)
        if inp.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)
    
    -- Particles — FIX: dt для независимости от FPS
    local particles = {}
    for i = 1, 50 do
        local p = Instance.new("Frame")
        p.Size = UDim2.new(0, 3, 0, 3)
        p.BackgroundColor3 = Color3.fromRGB(255,255,255)
        p.BackgroundTransparency = 0.6
        p.BorderSizePixel = 0
        p.ZIndex = 5
        p.Parent = frame
        Instance.new("UICorner", p).CornerRadius = UDim.new(1,0)
        particles[i] = {obj = p, phase = math.random()*math.pi*2}
    end
    
    local lastTime = tick()
    RunService.Heartbeat:Connect(function()
        local dt = tick() - lastTime
        lastTime = tick()
        
        for _, data in ipairs(particles) do
            data.phase = data.phase + dt * 1.8  -- скорость регулируй здесь (1.8 = нормально)
            local x = 0.5 + math.sin(data.phase) * 0.45
            local y = 0.5 + math.cos(data.phase * 1.3) * 0.45
            data.obj.Position = UDim2.new(x, 0, y, 0)
            data.obj.BackgroundTransparency = 0.4 + math.sin(data.phase * 6) * 0.35
        end
    end)
    
    return frame
end

local main = createGUI()

-- Остальные фичи (Fly, Noclip, ESP, Aimbot) — добавь свои рабочие версии из v5/v6
-- Пример auto-aimbot (вставь в конец)

local function toggleAimbot(enabled)
    Settings.Aimbot = enabled
    if aimbotConnection then aimbotConnection:Disconnect() end
    
    if not enabled then return end
    
    aimbotConnection = RunService.RenderStepped:Connect(function()
        if not Settings.Aimbot or not player.Character then return end
        
        local closest = nil
        local bestDist = math.huge
        
        for _, p in Players:GetPlayers() do
            if p == player or not p.Character or not p.Character:FindFirstChild("Head") then continue end
            if Settings.TeamCheck and p.Team == player.Team then continue end
            
            local head = p.Character.Head
            local screen, vis = camera:WorldToViewportPoint(head.Position)
            if not vis then continue end
            
            -- LOS
            local dir = head.Position - camera.CFrame.Position
            local params = RaycastParams.new()
            params.FilterDescendantsInstances = {player.Character, p.Character}
            params.FilterType = Enum.RaycastFilterType.Blacklist
            if Workspace:Raycast(camera.CFrame.Position, dir, params) then continue end
            
            local dist = (Vector2.new(screen.X, screen.Y) - Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)).Magnitude
            if dist < Settings.AimbotFOV and dist < bestDist then
                bestDist = dist
                closest = head
            end
        end
        
        if closest then
            local targetCF = CFrame.lookAt(camera.CFrame.Position, closest.Position)
            camera.CFrame = camera.CFrame:Lerp(targetCF, Settings.AimbotSmooth)
        end
    end)
end

-- Добавь toggleAimbot(true) для теста или кнопку в GUI
toggleAimbot(true)  -- авто-вкл для теста

print("Salt v8 загружен — точки спокойные, GUI стабильный")
