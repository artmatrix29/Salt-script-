-- Salt v6 (Tabs + Fixed Aimbot + Better Cleanup)
-- Только для личного использования

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local mouse = player:GetMouse()
local camera = Workspace.CurrentCamera

local Settings = {
    Fly = false, FlySpeed = 50,
    Noclip = false,
    Speed = 16,
    InfiniteJump = false,
    ESP = false,
    Aimbot = false,
    AimbotFOV = 120,
    AimbotSmooth = 0.18,
    TeamCheck = true
}

local flyBodyVelocity = nil
local noclipConnection = nil
local drawings = {boxes = {}, names = {}, fovCircle = nil}
local currentTab = "Movement"

-- ScreenGui
local sg = Instance.new("ScreenGui")
sg.Name = "SaltGUI"
sg.ResetOnSpawn = false
sg.Parent = game:GetService("CoreGui")

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 280, 0, 480)
mainFrame.Position = UDim2.new(0, 20, 0, 20)
mainFrame.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = sg
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 10)

-- Shadow
local shadow = Instance.new("Frame")
shadow.Size = UDim2.new(1,8,1,8)
shadow.Position = UDim2.new(0,-4,0,-4)
shadow.BackgroundColor3 = Color3.fromRGB(0,0,0)
shadow.BackgroundTransparency = 0.65
shadow.ZIndex = -1
shadow.Parent = mainFrame
Instance.new("UICorner", shadow).CornerRadius = UDim.new(0, 14)

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,40)
title.BackgroundTransparency = 1
title.Text = "Salt v6"
title.TextColor3 = Color3.fromRGB(240,240,240)
title.TextSize = 26
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Center
title.Parent = mainFrame

-- Tab Bar
local tabBar = Instance.new("Frame")
tabBar.Size = UDim2.new(1, -20, 0, 35)
tabBar.Position = UDim2.new(0,10,0,45)
tabBar.BackgroundTransparency = 1
tabBar.Parent = mainFrame

local tabs = {"Movement", "Visuals", "Combat"}
local tabFrames = {}
local tabButtons = {}

for i, tabName in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1/#tabs - 0.05, -5, 1, 0)
    btn.Position = UDim2.new((i-1)/#tabs, 0, 0, 0)
    btn.BackgroundColor3 = Color3.fromRGB(35,35,35)
    btn.Text = tabName
    btn.TextColor3 = Color3.fromRGB(180,180,180)
    btn.Font = Enum.Font.GothamSemibold
    btn.TextSize = 16
    btn.Parent = tabBar
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)
    
    local content = Instance.new("Frame")
    content.Size = UDim2.new(1,-20,1,-100)
    content.Position = UDim2.new(0,10,0,90)
    content.BackgroundTransparency = 1
    content.Visible = (tabName == "Movement")
    content.Parent = mainFrame
    tabFrames[tabName] = content
    
    btn.MouseButton1Click:Connect(function()
        for _, f in pairs(tabFrames) do f.Visible = false end
        tabFrames[tabName].Visible = true
        for _, b in pairs(tabButtons) do b.BackgroundColor3 = Color3.fromRGB(35,35,35) end
        btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    end)
    
    table.insert(tabButtons, btn)
end

-- Particles (в фоне главного фрейма)
local particles = {}
for i = 1, 60 do
    local p = Instance.new("Frame")
    p.Size = UDim2.new(0,3,0,3)
    p.BackgroundColor3 = Color3.fromRGB(255,255,255)
    p.BackgroundTransparency = 0.6
    p.BorderSizePixel = 0
    p.ZIndex = 0
    p.Parent = mainFrame
    Instance.new("UICorner", p).CornerRadius = UDim.new(1,0)
    p.Position = UDim2.new(math.random(),0,math.random(),0)
    table.insert(particles, p)
end

RunService.RenderStepped:Connect(function(dt)
    for _, p in particles do
        local t = tick() + i*0.3
        local x = 0.5 + math.sin(t*1.2)*0.45
        local y = 0.5 + math.cos(t*0.9)*0.45
        p.Position = UDim2.new(x,0,y,0)
        p.BackgroundTransparency = 0.4 + math.sin(t*5)*0.3
    end
end)

-- Draggable
local dragging, dragInput, dragStart, startPos
title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)
title.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
end)
RunService.RenderStepped:Connect(function()
    if dragging and dragInput then
        local delta = dragInput.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- ========== Функции фич ==========

local function toggleFly(v) Settings.Fly = v
    -- (твой старый fly код, как в v5 — оставляю без изменений, он работал)
    if not v and flyBodyVelocity then flyBodyVelocity:Destroy() flyBodyVelocity = nil end
    -- ... остальной fly toggle
end

-- Noclip, Speed, InfiniteJump — аналогично твоим предыдущим версиям

-- ESP (оставляем как было, зелёный/красный)
-- ... (вставь функцию toggleESP из v5)

-- FIXED Aimbot
local function getBestTarget()
    local best = nil
    local bestDist = math.huge
    local center = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
    
    for _, plr in Players:GetPlayers() do
        if plr == player or not plr.Character or not plr.Character:FindFirstChild("Head") then continue end
        if Settings.TeamCheck and plr.Team == player.Team then continue end
        
        local head = plr.Character.Head
        local headPos, visible = camera:WorldToViewportPoint(head.Position)
        if not visible then continue end
        
        -- LOS check
        local rayDir = head.Position - camera.CFrame.Position
        local params = RaycastParams.new()
        params.FilterDescendantsInstances = {player.Character or game, plr.Character}
        params.FilterType = Enum.RaycastFilterType.Exclude
        local res = Workspace:Raycast(camera.CFrame.Position, rayDir, params)
        if res then continue end  -- за стеной
        
        local dist = (Vector2.new(headPos.X, headPos.Y) - center).Magnitude
        local fovRadius = (Settings.AimbotFOV / 2) * (camera.ViewportSize.Y / math.tan(math.rad(camera.FieldOfView/2)))
        if dist < fovRadius and dist < bestDist then
            bestDist = dist
            best = head
        end
    end
    return best
end

local function toggleAimbot(v)
    Settings.Aimbot = v
    if drawings.fovCircle then drawings.fovCircle:Remove() drawings.fovCircle = nil end
    
    if not v then return end
    
    drawings.fovCircle = Drawing.new("Circle")
    drawings.fovCircle.Thickness = 1.5
    drawings.fovCircle.Color = Color3.fromRGB(220, 80, 80)
    drawings.fovCircle.Transparency = 0.75
    drawings.fovCircle.NumSides = 64
    drawings.fovCircle.Radius = 0
    drawings.fovCircle.Position = Vector2.new(camera.ViewportSize.X/2, camera.ViewportSize.Y/2)
    drawings.fovCircle.Visible = true
    
    RunService.RenderStepped:Connect(function()
        if not Settings.Aimbot then return end
        
        drawings.fovCircle.Radius = Settings.AimbotFOV * (camera.ViewportSize.Y / (2 * math.tan(math.rad(camera.FieldOfView/2))))
        
        if not UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then return end
        
        local targetHead = getBestTarget()
        if not targetHead then return end
        
        local targetCFrame = CFrame.lookAt(camera.CFrame.Position, targetHead.Position + Vector3.new(0,0.15,0))
        camera.CFrame = camera.CFrame:Lerp(targetCFrame, Settings.AimbotSmooth)
    end)
end

-- ========== Добавляем элементы в табы ==========

-- Movement Tab
local mov = tabFrames["Movement"]
yOffset = 0

createToggle("Fly", toggleFly, mov, yOffset) yOffset += 40
createSlider("Fly Speed", 10, 300, 50, function(v) Settings.FlySpeed = v end, mov, yOffset) yOffset += 60
createToggle("Noclip", toggleNoclip, mov, yOffset) yOffset += 40
createSlider("Walk Speed", 16, 400, 16, function(v) Settings.Speed = v  -- apply to humanoid end, mov, yOffset) yOffset += 60
createToggle("Infinite Jump", function(v) Settings.InfiniteJump = v end, mov, yOffset)

-- Visuals Tab
local vis = tabFrames["Visuals"]
yOffset = 0
createToggle("ESP", toggleESP, vis, yOffset)

-- Combat Tab
local comb = tabFrames["Combat"]
yOffset = 0
createToggle("Aimbot (RMB hold)", toggleAimbot, comb, yOffset) yOffset += 40
createToggle("Team Check", function(v) Settings.TeamCheck = v end, comb, yOffset) yOffset += 40
createSlider("Aimbot FOV", 40, 300, 120, function(v) Settings.AimbotFOV = v end, comb, yOffset) yOffset += 60
createSlider("Aimbot Smooth", 0.05, 0.4, 0.18, function(v) Settings.AimbotSmooth = v end, comb, yOffset)

print("Salt v6 запущен — табы + aimbot fixed")
