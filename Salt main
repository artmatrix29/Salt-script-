-- Salt v7 (Auto Aimbot + Tabs Fixed)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local mouse = player:GetMouse()
local camera = Workspace.CurrentCamera

local Settings = {
    Fly = false, FlySpeed = 50,
    Noclip = false,
    Speed = 16,
    InfiniteJump = false,
    ESP = false,
    Aimbot = false,
    AimbotFOV = 120,
    AimbotSmooth = 0.18,
    TeamCheck = true,
    HoldKeyAimbot = false  -- Left Alt hold
}

local flyBodyVelocity = nil
local noclipConnection = nil
local espConnection = nil
local aimbotConnection = nil
local drawings = {boxes = {}, names = {}, fovCircle = nil}

-- GUI
local sg = Instance.new("ScreenGui")
sg.Name = "SaltGUI"
sg.ResetOnSpawn = false
sg.Parent = game:GetService("CoreGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 280, 0, 450)
mainFrame.Position = UDim2.new(0, 15, 0, 15)
mainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = sg
local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

-- Shadow
local shadow = Instance.new("Frame")
shadow.Size = UDim2.new(1, 4, 1, 4)
shadow.Position = UDim2.new(0, -2, 0, -2)
shadow.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
shadow.BackgroundTransparency = 0.7
shadow.ZIndex = -1
shadow.Parent = mainFrame
Instance.new("UICorner", shadow).CornerRadius = UDim.new(0, 14)

-- Title (draggable)
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 45)
title.BackgroundTransparency = 1
title.Text = "Salt v7 (Auto Aimbot)"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 28
title.Font = Enum.Font.GothamBold
title.TextXAlignment = Enum.TextXAlignment.Center
title.Parent = mainFrame

-- Draggable
local dragging = false
local dragStart, startPos
title.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
    end
end)
title.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)
UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

-- Tab Bar
local tabBar = Instance.new("Frame")
tabBar.Size = UDim2.new(1, -20, 0, 35)
tabBar.Position = UDim2.new(0, 10, 0, 50)
tabBar.BackgroundTransparency = 1
tabBar.Parent = mainFrame

local tabs = {"Movement", "Visuals", "Combat"}
local tabButtons = {}
local tabContents = {}

for i, tab in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1/#tabs, 0, 1, 0)
    btn.Position = UDim2.new((i-1)/#tabs, 0, 0, 0)
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.Text = tab
    btn.TextColor3 = Color3.fromRGB(200, 200, 200)
    btn.Font = Enum.Font.GothamSemibold
    btn.TextSize = 16
    btn.Parent = tabBar
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    
    local content = Instance.new("ScrollingFrame")
    content.Size = UDim2.new(1, -20, 1, -100)
    content.Position = UDim2.new(0, 10, 0, 90)
    content.BackgroundTransparency = 1
    content.BorderSizePixel = 0
    content.ScrollBarThickness = 6
    content.CanvasSize = UDim2.new(0, 0, 0, 0)
    content.Visible = i == 1
    content.Parent = mainFrame
    tabContents[tab] = content
    
    btn.MouseButton1Click:Connect(function()
        for _, c in pairs(tabContents) do c.Visible = false end
        tabContents[tab].Visible = true
        for _, b in pairs(tabButtons) do b.BackgroundColor3 = Color3.fromRGB(50, 50, 50) end
        btn.BackgroundColor3 = Color3.fromRGB(0, 170, 100)
    end)
    table.insert(tabButtons, btn)
end

-- Particles
local particles = {}
for i = 1, 60 do
    local p = Instance.new("Frame")
    p.Size = UDim2.new(0, 4, 0, 4)
    p.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    p.BackgroundTransparency = 0.5
    p.BorderSizePixel = 0
    p.ZIndex = 1
    p.Parent = mainFrame
    Instance.new("UICorner", p).CornerRadius = UDim.new(1, 0)
    table.insert(particles, p)
end
RunService.Heartbeat:Connect(function()
    for i, p in ipairs(particles) do
        local phase = tick() * 1.5 + i
        p.Position = UDim2.new(math.sin(phase) * 0.4 + 0.5, 0, math.cos(phase * 1.2) * 0.4 + 0.5, 0)
        p.BackgroundTransparency = 0.3 + math.sin(phase * 4) * 0.3
    end
end)

-- Universal Toggle/Slider functions (with parent frame)
local function createToggle(parent, name, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 35)
    frame.BackgroundTransparency = 1
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.Text = name
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.TextSize = 16
    label.Font = Enum.Font.GothamSemibold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame
    
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 50, 0, 25)
    btn.Position = UDim2.new(1, -55, 0, 5)
    btn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    btn.Text = "OFF"
    btn.TextColor3 = Color3.fromRGB(180, 180, 180)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.Parent = frame
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    
    local state = false
    btn.MouseButton1Click:Connect(function()
        state = not state
        btn.Text = state and "ON" or "OFF"
        btn.BackgroundColor3 = state and Color3.fromRGB(0, 200, 120) or Color3.fromRGB(50, 50, 50)
        btn.TextColor3 = state and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(180, 180, 180)
        callback(state)
    end)
    return frame
end

local function createSlider(parent, name, min, max, default, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 55)
    frame.BackgroundTransparency = 1
    frame.Parent = parent
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 25)
    label.BackgroundTransparency = 1
    label.Text = name .. ": " .. default
    label.TextColor3 = Color3.fromRGB(220, 220, 220)
    label.TextSize = 15
    label.Font = Enum.Font.Gotham
    label.Parent = frame
    
    local bar = Instance.new("Frame")
    bar.Size = UDim2.new(1, 0, 0, 6)
    bar.Position = UDim2.new(0, 0, 1, -10)
    bar.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    bar.Parent = frame
    Instance.new("UICorner", bar).CornerRadius = UDim.new(1, 0)
    
    local fill = Instance.new("Frame")
    fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
    fill.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
    fill.Parent = bar
    Instance.new("UICorner", fill).CornerRadius = UDim.new(1, 0)
    
    local knob = Instance.new("Frame")
    knob.Size = UDim2.new(0, 20, 0, 20)
    knob.Position = UDim2.new((default - min) / (max - min), -10, 0.5, -10)
    knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    knob.Parent = bar
    Instance.new("UICorner", knob).CornerRadius = UDim.new(1, 0)
    
    local dragging = false
    knob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
    end)
    RunService.RenderStepped:Connect(function()
        if dragging and bar.AbsoluteSize.X > 0 then
            local mousePos = UserInputService:GetMouseLocation()
            local rel = math.clamp((mousePos.X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
            local val = math.floor(min + (max - min) * rel)
            knob.Position = UDim2.new(rel, -10, 0.5, -10)
            fill.Size = UDim2.new(rel, 0, 1, 0)
            label.Text = name .. ": " .. val
            callback(val)
        end
    end)
    return frame
end

-- Fly, Noclip, InfiniteJump, Speed — твои старые функции (вставь из v5, они работают)
-- ... (Fly как в v4/v5, Noclip Stepped, JumpRequest, WalkSpeed on CharacterAdded)

-- FIXED Auto Aimbot
local function getClosestGreen()
    local closest, minDist = nil, math.huge
    local mouseScreen = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
    local fovRadius = Settings.AimbotFOV / 2 * (camera.ViewportSize.Y / math.tan(math.rad(camera.FieldOfView / 2)))
    
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr == player or not plr.Character or not plr.Character:FindFirstChild("Head") then continue end
        if Settings.TeamCheck and plr.Team == player.Team then continue end
        
        local head = plr.Character.Head
        local hum = plr.Character:FindFirstChild("Humanoid")
        if not hum or hum.Health <= 0 then continue end
        
        local screenPos, onScreen = camera:WorldToViewportPoint(head.Position)
        if not onScreen then continue end
        
        -- LOS Raycast
        local rayDir = head.Position - camera.CFrame.Position
        local params = RaycastParams.new()
        params.FilterType = Enum.RaycastFilterType.Blacklist
        params.FilterDescendantsInstances = {player.Character, plr.Character}
        local rayHit = Workspace:Raycast(camera.CFrame.Position, rayDir.Unit * rayDir.Magnitude, params)
        if rayHit then continue end  -- за стеной
        
        local dist = (Vector2.new(screenPos.X, screenPos.Y) - mouseScreen).Magnitude
        if dist < fovRadius and dist < minDist then
            minDist = dist
            closest = head
        end
    end
    return closest
end

local function toggleAimbot(enabled)
    Settings.Aimbot = enabled
    if aimbotConnection then aimbotConnection:Disconnect() end
    if drawings.fovCircle then drawings.fovCircle:Remove() drawings.fovCircle = nil end
    
    if not enabled then return end
    
    -- FOV Circle
    drawings.fovCircle = Drawing.new("Circle")
    drawings.fovCircle.Thickness = 2
    drawings.fovCircle.Color = Color3.fromRGB(255, 100, 100)
    drawings.fovCircle.Transparency = 0.8
    drawings.fovCircle.NumSides = 64
    drawings.fovCircle.Visible = true
    
    -- Auto Aimbot Loop
    aimbotConnection = RunService.RenderStepped:Connect(function()
        if not Settings.Aimbot then return end
        
        drawings.fovCircle.Position = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
        drawings.fovCircle.Radius = Settings.AimbotFOV / 2 * (camera.ViewportSize.Y / math.tan(math.rad(camera.FieldOfView / 2)))
        
        local target = getClosestGreen()
        if target then
            local targetPos = target.Position
            local targetCFrame = CFrame.lookAt(camera.CFrame.Position, targetPos)
            camera.CFrame = camera.CFrame:Lerp(targetCFrame, Settings.AimbotSmooth)
        end
    end)
end

-- Hold Key Aimbot (Left Alt)
local function toggleHoldKey(enabled)
    Settings.HoldKeyAimbot = enabled
    -- Аналогично, но с проверкой IsKeyDown(Enum.KeyCode.LeftAlt)
end

-- ESP (как в v5)
-- ... (вставь toggleESP из v5)

-- Добавляем в табы
createToggle(tabContents["Movement"], "Fly", function(v) toggleFly(v) end)
-- ... другие для Movement

createToggle(tabContents["Visuals"], "ESP", function(v) toggleESP(v) end)

createToggle(tabContents["Combat"], "Aimbot (Auto)", toggleAimbot)
createToggle(tabContents["Combat"], "Hold Key (Left Alt)", toggleHoldKey)
createSlider(tabContents["Combat"], "FOV", 50, 360, 120, function(v) Settings.AimbotFOV = v end)
createSlider(tabContents["Combat"], "Smooth", 0.05, 0.5, 0.18, function(v) Settings.AimbotSmooth = v end)
createToggle(tabContents["Combat"], "Team Check", function(v) Settings.TeamCheck = v end)

print("Salt v7 — Auto Aimbot готов!")
